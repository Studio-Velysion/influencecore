services:
  postiz:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: postiz
    restart: unless-stopped
    # Coolify will inject env vars here (recommended) OR you can use env_file.
    environment:
      # Required (minimum)
      FRONTEND_URL: ${FRONTEND_URL}
      MAIN_URL: ${MAIN_URL}
      # Important: frontend uses this as baseUrl; with nginx proxy it should end with /api
      NEXT_PUBLIC_BACKEND_URL: ${NEXT_PUBLIC_BACKEND_URL}
      BACKEND_INTERNAL_URL: http://localhost:3000
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: ${REDIS_URL}
      JWT_SECRET: ${JWT_SECRET}
      STORAGE_PROVIDER: ${STORAGE_PROVIDER:-local}

      # Optional but useful
      NODE_ENV: production

    # Persist uploads when STORAGE_PROVIDER=local
    volumes:
      - postiz-uploads:/uploads

    # Internal: nginx listens on 80
    ports:
      - "${POSTIZ_PORT:-80}:80"

  postgres:
    image: postgres:17-alpine
    container_name: postiz-postgres
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postiz-local-pwd}
      POSTGRES_USER: ${POSTGRES_USER:-postiz-local}
      POSTGRES_DB: ${POSTGRES_DB:-postiz-db-local}
    volumes:
      - postiz-postgres:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    container_name: postiz-redis
    restart: unless-stopped
    volumes:
      - postiz-redis:/data

volumes:
  postiz-uploads:
  postiz-postgres:
  postiz-redis:


